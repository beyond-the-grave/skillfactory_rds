{"database_id":2,"started_at":"2021-08-31T12:48:14.622603Z","json_query":{"type":"native","native":{"query":"    /*------------------------- TABLE_1 -------------------------\r\n      -- ХАРАКТЕРИСТИКА САМОЛЕТА --------------------------------  */\r\n\r\nwith table_1 as (\r\n    SELECT f.flight_id,air.model,air.range ---- AIRCRAFT MODEL & FLIGHT RANGE\r\n    FROM dst_project.flights f\r\n        join dst_project.aircrafts air on air.aircraft_code = f.aircraft_code\r\n    GROUP BY\r\n        f.flight_id,air.model,air.range),\r\n    \r\n    /*------------------------- TABLE_2 -------------------------\r\n      -- СУММА КУПЛЕННЫХ БИЛЕТОВ --------------------------------  */\r\n        \r\n    table_2 as (\r\n    SELECT \r\n    f.flight_id, sum(tf.amount) as book_amount ---- TOTAL AMOUNT PER FLIGHT\r\n    FROM dst_project.flights f\r\n        join dst_project.ticket_flights tf on tf.flight_id = f.flight_id\r\n    GROUP BY\r\n        f.flight_id),\r\n    \r\n    /*------------------------- TABLE_3 -------------------------\r\n      -- КОЛИЧЕСТВО МЕСТ В САМОЛЕТЕ -----------------------------  */\r\n    \r\n    table_3 as (\r\n    SELECT \r\n    f.flight_id, count(s.seat_no) as total_seat ---- TOTAL SEAT ON USED AIRPLANE \r\n    FROM dst_project.flights f\r\n        join dst_project.seats s on s.aircraft_code = f.aircraft_code\r\n    GROUP BY\r\n        f.flight_id),\r\n    \r\n    /*------------------------- TABLE_4 -------------------------\r\n      -- КОЛИЧЕСТВО ИСПОЛЬЗОВАННЫХ МЕСТ В САМОЛЕТЕ --------------  */\r\n        \r\n    table_4 as (\r\n    SELECT \r\n    f.flight_id, count(bord.seat_no) as used_seat ---- USED SEAT PER FLIGHT\r\n    FROM dst_project.flights f\r\n        join dst_project.boarding_passes bord on bord.flight_id = f.flight_id\r\n    GROUP BY\r\n        f.flight_id),\r\n        \r\n        \r\n    /*------------------------- TABLE_5 -------------------------\r\n      -- ВРЕМЯ ПОЛЕТА ИЗ АНАПЫ ДО КОНЕЧНОГО АЭРОПОРТА -----------  */\r\n    \r\n    table_5 AS (\r\n    SELECT\r\n        f.flight_id,\r\n        EXTRACT(EPOCH FROM (f.scheduled_arrival - f.scheduled_departure)) / 60 AS flight_duration ---- FLIGHT DURATION PER FLIGHT\r\n    FROM\r\n        dst_project.flights f\r\n    GROUP BY\r\n        f.flight_id)\r\n        \r\n    \r\n    ------------------------- JOIN -------------------------\r\n    \r\nselect f.flight_id,f.arrival_airport,\r\n        table_1.model,table_1.range,\r\n        table_2.book_amount,\r\n        table_3.total_seat,\r\n        table_4.used_seat,\r\n        (table_3.total_seat - table_4.used_seat) as seat_diff,\r\n        table_5.flight_duration\r\n    from dst_project.flights f\r\n    left join table_1 on f.flight_id = table_1.flight_id\r\n    left join table_2 on f.flight_id = table_2.flight_id\r\n    left join table_3 on f.flight_id = table_3.flight_id\r\n    left join table_4 on f.flight_id = table_4.flight_id\r\n    left join table_5 on f.flight_id = table_5.flight_id\r\nWHERE departure_airport = 'AAQ'\r\n  AND (date_trunc('month', scheduled_departure) in ('2017-01-01','2017-02-01', '2017-12-01'))\r\n  AND status not in ('Cancelled')","template-tags":{}},"database":2,"middleware":{"skip-results-metadata?":true,"format-rows?":false},"async?":true},"status":"failed","class":"class java.io.IOException","stacktrace":["java.base/java.io.FileOutputStream.writeBytes(Native Method)","java.base/java.io.FileOutputStream.write(Unknown Source)","java.base/sun.nio.cs.StreamEncoder.writeBytes(Unknown Source)","java.base/sun.nio.cs.StreamEncoder.implWrite(Unknown Source)","java.base/sun.nio.cs.StreamEncoder.implWrite(Unknown Source)","java.base/sun.nio.cs.StreamEncoder.write(Unknown Source)","java.base/java.io.OutputStreamWriter.write(Unknown Source)","java.base/java.io.BufferedWriter.flushBuffer(Unknown Source)","java.base/java.io.BufferedWriter.write(Unknown Source)","java.base/java.io.Writer.write(Unknown Source)","org.apache.poi.xssf.streaming.SheetDataWriter.writeCell(SheetDataWriter.java:302)","org.apache.poi.xssf.streaming.SheetDataWriter.writeRow(SheetDataWriter.java:204)","org.apache.poi.xssf.streaming.SXSSFSheet.flushOneRow(SXSSFSheet.java:1878)","org.apache.poi.xssf.streaming.SXSSFSheet.flushRows(SXSSFSheet.java:1853)","org.apache.poi.xssf.streaming.SXSSFSheet.flushRows(SXSSFSheet.java:1867)","org.apache.poi.xssf.streaming.SXSSFWorkbook.flushSheets(SXSSFWorkbook.java:948)","org.apache.poi.xssf.streaming.SXSSFWorkbook.write(SXSSFWorkbook.java:921)","dk.ative.docjure.spreadsheet$save_workbook_into_stream_BANG_.invokeStatic(spreadsheet.clj:96)","dk.ative.docjure.spreadsheet$save_workbook_into_stream_BANG_.invoke(spreadsheet.clj:91)","--> query_processor.streaming.xlsx$fn$reify__52537.finish_BANG_(xlsx.clj:124)","query_processor.streaming$streaming_reducedf$fn__52549.invoke(streaming.clj:40)","query_processor.context$reducedf.invokeStatic(context.clj:77)","query_processor.context$reducedf.invoke(context.clj:72)","query_processor.context.default$default_reducef.invokeStatic(default.clj:66)","query_processor.context.default$default_reducef.invoke(default.clj:50)","query_processor.context$reducef.invokeStatic(context.clj:69)","query_processor.context$reducef.invoke(context.clj:62)","query_processor.context.default$default_runf$respond_STAR___36409.invoke(default.clj:71)","driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:394)","driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:376)","driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:385)","driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:376)","driver.sql_jdbc$fn__78155.invokeStatic(sql_jdbc.clj:49)","driver.sql_jdbc$fn__78155.invoke(sql_jdbc.clj:47)","query_processor.context$executef.invokeStatic(context.clj:59)","query_processor.context$executef.invoke(context.clj:48)","query_processor.context.default$default_runf.invokeStatic(default.clj:70)","query_processor.context.default$default_runf.invoke(default.clj:68)","query_processor.context$runf.invokeStatic(context.clj:45)","query_processor.context$runf.invoke(context.clj:39)","query_processor.reducible$pivot.invokeStatic(reducible.clj:34)","query_processor.reducible$pivot.invoke(reducible.clj:31)","query_processor.middleware.mbql_to_native$mbql__GT_native$fn__44130.invoke(mbql_to_native.clj:26)","query_processor.middleware.check_features$check_features$fn__43406.invoke(check_features.clj:42)","query_processor.middleware.limit$limit$fn__44116.invoke(limit.clj:38)","query_processor.middleware.cache$maybe_return_cached_results$fn__43057.invoke(cache.clj:214)","query_processor.middleware.optimize_datetime_filters$optimize_datetime_filters$fn__44295.invoke(optimize_datetime_filters.clj:133)","query_processor.middleware.auto_parse_filter_values$auto_parse_filter_values$fn__42204.invoke(auto_parse_filter_values.clj:44)","query_processor.middleware.wrap_value_literals$wrap_value_literals$fn__45861.invoke(wrap_value_literals.clj:149)","query_processor.middleware.annotate$add_column_info$fn__41959.invoke(annotate.clj:575)","query_processor.middleware.permissions$check_query_permissions$fn__43281.invoke(permissions.clj:71)","query_processor.middleware.pre_alias_aggregations$pre_alias_aggregations$fn__44813.invoke(pre_alias_aggregations.clj:40)","query_processor.middleware.cumulative_aggregations$handle_cumulative_aggregations$fn__43479.invoke(cumulative_aggregations.clj:61)","query_processor.middleware.resolve_joined_fields$resolve_joined_fields$fn__45050.invoke(resolve_joined_fields.clj:36)","query_processor.middleware.resolve_joins$resolve_joins$fn__45369.invoke(resolve_joins.clj:183)","query_processor.middleware.add_implicit_joins$add_implicit_joins$fn__37684.invoke(add_implicit_joins.clj:254)","query_processor.middleware.large_int_id$convert_id_to_string$fn__44091.invoke(large_int_id.clj:44)","query_processor.middleware.format_rows$format_rows$fn__44071.invoke(format_rows.clj:75)","query_processor.middleware.desugar$desugar$fn__43545.invoke(desugar.clj:22)","query_processor.middleware.binning$update_binning_strategy$fn__42563.invoke(binning.clj:229)","query_processor.middleware.resolve_fields$resolve_fields$fn__43081.invoke(resolve_fields.clj:24)","query_processor.middleware.add_dimension_projections$add_remapping$fn__37228.invoke(add_dimension_projections.clj:316)","query_processor.middleware.add_implicit_clauses$add_implicit_clauses$fn__37435.invoke(add_implicit_clauses.clj:141)","query_processor.middleware.add_source_metadata$add_source_metadata_for_source_queries$fn__37833.invoke(add_source_metadata.clj:105)","query_processor.middleware.reconcile_breakout_and_order_by_bucketing$reconcile_breakout_and_order_by_bucketing$fn__45010.invoke(reconcile_breakout_and_order_by_bucketing.clj:98)","query_processor.middleware.auto_bucket_datetimes$auto_bucket_datetimes$fn__42151.invoke(auto_bucket_datetimes.clj:140)","query_processor.middleware.resolve_source_table$resolve_source_tables$fn__43128.invoke(resolve_source_table.clj:46)","query_processor.middleware.parameters$substitute_parameters$fn__44795.invoke(parameters.clj:114)","query_processor.middleware.resolve_referenced$resolve_referenced_card_resources$fn__43180.invoke(resolve_referenced.clj:80)","query_processor.middleware.expand_macros$expand_macros$fn__43801.invoke(expand_macros.clj:158)","query_processor.middleware.add_timezone_info$add_timezone_info$fn__37864.invoke(add_timezone_info.clj:15)","query_processor.middleware.splice_params_in_response$splice_params_in_response$fn__45731.invoke(splice_params_in_response.clj:32)","query_processor.middleware.resolve_database_and_driver$resolve_database_and_driver$fn__45021$fn__45025.invoke(resolve_database_and_driver.clj:33)","driver$do_with_driver.invokeStatic(driver.clj:61)","driver$do_with_driver.invoke(driver.clj:57)","query_processor.middleware.resolve_database_and_driver$resolve_database_and_driver$fn__45021.invoke(resolve_database_and_driver.clj:27)","query_processor.middleware.fetch_source_query$resolve_card_id_source_tables$fn__44019.invoke(fetch_source_query.clj:267)","query_processor.middleware.store$initialize_store$fn__45740$fn__45741.invoke(store.clj:11)","query_processor.store$do_with_store.invokeStatic(store.clj:46)","query_processor.store$do_with_store.invoke(store.clj:40)","query_processor.middleware.store$initialize_store$fn__45740.invoke(store.clj:10)","query_processor.middleware.validate$validate_query$fn__45749.invoke(validate.clj:10)","query_processor.middleware.normalize_query$normalize$fn__44143.invoke(normalize_query.clj:22)","query_processor.middleware.add_rows_truncated$add_rows_truncated$fn__37702.invoke(add_rows_truncated.clj:36)","query_processor.middleware.results_metadata$record_and_return_metadata_BANG_$fn__45716.invoke(results_metadata.clj:143)","query_processor.middleware.constraints$add_default_userland_constraints$fn__43422.invoke(constraints.clj:42)","query_processor.middleware.process_userland_query$process_userland_query$fn__44884.invoke(process_userland_query.clj:136)","query_processor.middleware.catch_exceptions$catch_exceptions$fn__43365.invoke(catch_exceptions.clj:174)","query_processor.reducible$async_qp$qp_STAR___36491$thunk__36492.invoke(reducible.clj:103)","query_processor.reducible$async_qp$qp_STAR___36491$fn__36494.invoke(reducible.clj:108)"],"context":"xlsx-download","error":"No space left on device","row_count":0,"running_time":0,"data":{"rows":[],"cols":[]}}